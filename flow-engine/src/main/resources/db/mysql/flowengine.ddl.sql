CREATE TABLE FLOW_TRACE (
  ID  INTEGER AUTO_INCREMENT PRIMARY KEY,
  ORDER_ID  VARCHAR(128) NOT NULL  COMMENT '订单id',
  TRACE_ID  VARCHAR(64) UNIQUE NOT NULL COMMENT '跟踪id',
  FLOW_NAME VARCHAR(64) NOT NULL COMMENT '流程名称',
  VERSION INTEGER NOT NULL COMMENT '流程版本',
  NODE VARCHAR(64) NOT NULL COMMENT '跟踪节点',
  RETRY_TIMES INTEGER DEFAULT 0 COMMENT '重试次数',
  NEXT_RETRY_TIME DATETIME  COMMENT '下次重试时间',
  NODE_NAME VARCHAR(64) COMMENT '节点名称',
  RETRY_MAX INTEGER COMMENT '最大次数',
  RETRY_MAX_LIMIT_NODE  VARCHAR(64) COMMENT '超限后流转节点',
  TARGET  VARCHAR(64) NOT NULL COMMENT '目标流转节点',
  RETRY_FAIL_TYPE VARCHAR(16) COMMENT '重试失败类型',
  RETREAT_UNIT  INTEGER COMMENT '退避单元',
  RETREAT_TYPE  VARCHAR(16) COMMENT '退避类型',
  RETREAT_TIME_UNIT VARCHAR(16) COMMENT '退避单位',
  START_TIME  DATETIME NOT NULL  COMMENT '开始时间',
  UPDATE_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '更新时间',
  EVENT_ID  VARCHAR(64) COMMENT '事件id',
  EVENT_TIME  DATETIME COMMENT '事件时间',
  EXECUTION_TARGET  TEXT  COMMENT '业务对象',
  ATTACHMENT  TEXT  COMMENT '附属信息'
) COMMENT '流程跟踪轨迹';
CREATE INDEX IDX_STIME ON FLOW_TRACE(START_TIME);
CREATE INDEX IDX_UTIME ON FLOW_TRACE(UPDATE_TIME);
CREATE INDEX IDX_NODE ON FLOW_TRACE(NODE);


CREATE TABLE FLOW_TRACE_BOMB (
  ID  INTEGER AUTO_INCREMENT PRIMARY KEY,
  ORDER_ID  VARCHAR(128) NOT NULL  COMMENT '订单id',
  TRACE_ID  VARCHAR(64) UNIQUE NOT NULL COMMENT '跟踪id',
  FLOW_NAME VARCHAR(64) NOT NULL COMMENT '流程名称',
  VERSION INTEGER NOT NULL COMMENT '流程版本',
  NODE VARCHAR(64) NOT NULL COMMENT '跟踪节点',
  RETRY_TIMES INTEGER DEFAULT 0 COMMENT '重试次数',
  NEXT_RETRY_TIME DATETIME  COMMENT '下次重试时间',
  NODE_NAME VARCHAR(64) COMMENT '节点名称',
  RETRY_MAX INTEGER COMMENT '最大次数',
  RETRY_MAX_LIMIT_NODE  VARCHAR(64) COMMENT '超限后流转节点',
  TARGET  VARCHAR(64) NOT NULL COMMENT '目标流转节点',
  RETRY_FAIL_TYPE VARCHAR(16) COMMENT '重试失败类型',
  RETREAT_UNIT  INTEGER COMMENT '退避单元',
  RETREAT_TYPE  VARCHAR(16) COMMENT '退避类型',
  RETREAT_TIME_UNIT VARCHAR(16) COMMENT '退避单位',
  START_TIME  DATETIME NOT NULL  COMMENT '开始时间',
  UPDATE_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '更新时间',
  EVENT_ID  VARCHAR(64) COMMENT '事件id',
  EVENT_TIME  DATETIME COMMENT '事件时间',
  EXECUTION_TARGET  TEXT  COMMENT '业务对象',
  ATTACHMENT  TEXT  COMMENT '附属信息'
) COMMENT '流程跟踪轨迹,隔离僵尸任务';
CREATE INDEX IDX_STIME ON FLOW_TRACE_BOMB(START_TIME);
CREATE INDEX IDX_UTIME ON FLOW_TRACE_BOMB(UPDATE_TIME);
CREATE INDEX IDX_NODE ON FLOW_TRACE_BOMB(NODE);


CREATE TABLE FLOW_TRACE_HISTORY (
  ID  INTEGER AUTO_INCREMENT PRIMARY KEY,
  ORDER_ID  VARCHAR(128)  NOT NULL  COMMENT '订单id',
  TRACE_ID  VARCHAR(64) UNIQUE NOT NULL COMMENT '跟踪id',
  FLOW_NAME VARCHAR(64) NOT NULL COMMENT '流程名称',
  VERSION INTEGER NOT NULL COMMENT '流程版本',
  NODE VARCHAR(64) NOT NULL COMMENT '跟踪节点',
  RETRY_TIMES INTEGER DEFAULT 0 COMMENT '重试次数',
  NEXT_RETRY_TIME DATETIME COMMENT '下次重试时间',
  NODE_NAME VARCHAR(64) COMMENT '节点名称',
  RETRY_MAX INTEGER COMMENT '最大次数',
  RETRY_MAX_LIMIT_NODE  VARCHAR(64) COMMENT '超限后流转节点',
  TARGET  VARCHAR(64) NOT NULL COMMENT '目标流转节点',
  RETRY_FAIL_TYPE VARCHAR(16) COMMENT '重试失败类型',
  RETREAT_UNIT  INTEGER COMMENT '退避单元',
  RETREAT_TYPE  VARCHAR(16) COMMENT '退避类型',
  RETREAT_TIME_UNIT VARCHAR(16) COMMENT '退避单位',
  START_TIME  DATETIME NOT NULL COMMENT '开始时间',
  UPDATE_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '更新时间',
  END_TIME  DATETIME NOT NULL COMMENT '结束时间',
  ERROR VARCHAR(256)  NOT NULL COMMENT '失败信息',
  EVENT_ID  VARCHAR(64) COMMENT '事件id',
  EVENT_TIME  DATETIME COMMENT '事件时间',
  EXECUTION_TARGET  TEXT  COMMENT '业务对象',
  ATTACHMENT  TEXT  COMMENT '附属信息'
) COMMENT '流程历史跟踪轨迹';